{% extends 'base.html' %}

{% block content %}

<h2><a href="{{ book['edition']['gr_url']}}" target="_blank">{{ book["title"] }}</a></h2>
<h4>{{ book["author_name"] }}</h4>

<div>
    <img src="{{ book['edition']['pic_url'] }}">
</div>

<h4> Page count: {{ book['edition']['num_pages'] }}</h4>
<h4> Publisher: {{ book['edition']['publisher'] }}</h4>
<h4> Date published: {{ book['edition']['date']}}</h4>
<h4> Description: {% autoescape false %}{{ book['description']}} {% endautoescape %} </h4>
<div>
    <button id="shelf-button">Shelve this book</button>
    <button id="review-button">Add a Review</button>
    <div id="user-shelves" class="hidden2">
        <form action='/shelve_book' method='POST'>
            <input type='hidden' name='book' value='{{ book["edition"]["gr_id"] }}' />
            <select name="shelf">
                {% for shelf in user.shelves %}
                    {# Consider using this block again after Bootstrap is implemented #}
                    {# {% if shelf.exclusive %} #}
                        {#<input type="radio" name="exclusive"
                        <option name="shelf" value="{{ shelf.name }}" />{{ shelf.name }} </option>
                    {% else %}
                       <input type="checkbox" name="shelf_name"
                        <option name="shelf" value="{{ shelf.name }}" />{{ shelf.name }}</option> </br> #}
                    {# {% endif %} #}

                    <option name="shelf" value="{{ shelf.name }}" />{{ shelf.name }}</option>
                {% endfor %}
            </select>
            <input type='submit' value='Add to my Shelves' />
        </form>
    </div>
    <div id="user-reviews" class="hidden2">
        <form action="/review_book", method="POST">
            <input type='hidden' name='book' value='{{ book["edition"]["gr_id"] }}' />
            <h5>Review this book:</h5>
            <input type="text" name="text" placeholder="Add your review here" required/> <br>
            <h5>Star Rating:</h5>
            <input type="number" name="star_rating" min="1" max="5">
            <h5>Started Reading:</h5>
            <input type="date" name="start_read">
            <h5>Finished Reading:</h5>
            <input type="date" name="end_read">
            <h5>Submit this review to Goodreads?</h5>
            <select name="private">
                <option name="private" value="f">Yes</option>
                <option name="private" value="t">No</option>
            </select>
            <p> Not submitting this review will still update your Readerboard reading history and stats. </p>
            <h5>Challenge Points</h5>
            {% if user.challenges %}
                {% for challenge in challenges %}
                    <input type="checkbox" name="challenge" value="{{ challenge.chal_id }}">{{ challenge.name }}<br>
                {% endfor %}
            {% else %}
                <p><a href="#">Add a challenge</a> and track your progress here!</p>
            {% endif %}
            <input type="submit" value="Send review"/>
        </form>
    </div>
</div>
<h3>Availability at local library:</h3>
{% if lib_copies %}
    <p>Copies Available: {{ lib_copies['available'] }}</p>
    <p>Number of Holds: {{ lib_copies['holds'] }}</p>
    <p>Total Copies Owned: {{ lib_copies['copies'] }}</p>
{% else %}
    <p>No copies found at the library!</p>
{% endif %}
<h3>Availability from Goodreads friends:</h3>

{# Friends that have marked this book as read go here, along with their star rating #}
{% if matches %}
    {% for match in matches %}
        <div>
            <img src="{{ match[0] }}">
            <p><a href="{{ match[3] }}">{{ match[1] }}</a></p>
            <p>Shelf: {{ match[2].title()}}</p>
        </div>
    {% endfor %}
{% else %}
    <p>It looks like none of your friends have read this book yet!</p>
{% endif %}
{% endblock %}